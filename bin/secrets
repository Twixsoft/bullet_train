#!/usr/bin/env bash

echo "Generating secret key and encrypted credentials for development."
EDITOR="cat" bin/rails credentials:edit >> /dev/null
# This makes sure we add `/config/credentials/development.key` to `.gitignore`.
EDITOR="cat" bin/rails credentials:edit --environment development >> /dev/null
mv config/master.key config/credentials/development.key
mv config/credentials.yml.enc config/credentials/development.yml.enc

echo "Generating secret key and encrypted credentials for test."
EDITOR="cat" bin/rails credentials:edit >> /dev/null
# This makes sure we add `/config/credentials/test.key` to `.gitignore`.
EDITOR="cat" bin/rails credentials:edit --environment test >> /dev/null
mv config/master.key config/credentials/test.key
mv config/credentials.yml.enc config/credentials/test.yml.enc

echo "Generating secret key and encrypted credentials for production."
EDITOR="cat" bin/rails credentials:edit >> /dev/null
# This makes sure we add `/config/credentials/production.key` to `.gitignore`.
EDITOR="cat" bin/rails credentials:edit --environment production >> /dev/null
mv config/master.key config/credentials/production.key
mv config/credentials.yml.enc config/credentials/production.yml.enc

echo "Finally, generating master secret key and global encrypted credentials."
EDITOR="cat" bin/rails credentials:edit >> /dev/null
